name: 'Template Composite Action'
description: 'A template for building composite actions.'
# Ref: https://docs.github.com/en/actions/creating-actions/creating-a-composite-action
author: 'rwaight'

# https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#inputs
inputs:
  gh-token:
    description: 'GITHUB_TOKEN or a `repo` scoped Personal Access Token (PAT), may be needed for the GitHub CLI.'
    required: false
    default: ${{ github.token }}
  my-example-input1:
    description: >-
      An example input that you can use. 
      Replace this with your own input description.
    required: true
  verbose:
    description: 'Determine if the action should run verbose tasks, defaults to false.'
    required: false
    default: 'false'

outputs:
  # https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#outputs-for-composite-actions
  action-output1:
    description: "The example output from this action. "
    value: ${{ steps.set-vars-output.outputs.EXAMPLE_ACTION_OUTPUT1 }}

runs:
  # https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#runs-for-composite-actions
  using: "composite"
  steps:

    - name: Validate that the runner OS is Linux
      if: ${{ runner.os != 'Linux' }}
      # https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-an-error-message
      run: |
        echo "::error title=â›” error hint::This action supports Linux only"
        exit 1
      shell: bash

    - name: Greet the triggering_actor
      if: inputs.verbose=='true' || runner.debug == '1'
      run: | 
        echo "Hello ${{ github.triggering_actor }}, the verbose variable is set to true."
      shell: bash

    - name: Verbose | Print the inputs
      if: inputs.verbose=='true' || ${{ runner.debug == '1' }}
      id: verbose-print-inputs
      run: | 
        echo "::group::starting the 'verbose-print-inputs' step... "
        echo ""
        ## Print the inputs if inputs.verbose=='true'
        ## the double number signs below are for line spacing and readability only
        ##
        echo "gh-token SHOULD BE MASKED, but is set to ${{ inputs.gh-token }} "
        echo "my-example-input1 is set to ${{ inputs.my-example-input1 }} "
        echo "verbose is set to ${{ inputs.verbose }} "
        ##
        echo ""
        echo "finishing the 'verbose-print-inputs' step... "
        echo "::endgroup::"
      shell: bash

    - name: Example action step replaceme
      id: replaceme
      run: |
        echo "::group::starting the 'replaceme' step... "
        echo ""
        ## the double number signs below are for line spacing and readability only
        ##
        echo "This action is only a template for building composite actions. "
        echo "Reference GitHub's creating a composite action guide, at "
        echo "https://docs.github.com/en/actions/creating-actions/creating-a-composite-action "
        echo " for more information. "
        echo ""
        ##
        echo "finishing the 'replaceme' step... "
        echo "::endgroup::"
      shell: bash

    - name: This is a template only
      id: template-example-output
      run: |
        echo "::group::starting the 'template-example-output' step... "
        echo ""
        ## Print a message about this being a template action only.
        ## the double number signs below are for line spacing and readability only
        ##
        echo "This action is only a template for building composite actions. "
        echo "Reference GitHub's creating a composite action guide, at "
        echo "https://docs.github.com/en/actions/creating-actions/creating-a-composite-action "
        echo " for more information. "
        echo ""
        echo "Running step 'template-example-output', which sends variables to GitHub output. "
        template_action_datetime=$(date +%Y%m%d-%Z-%H%M)
        echo "The current datetime is ${template_action_datetime}"
        echo "Setting EXAMPLE_ACTION_OUTPUT1 to '${template_action_datetime}'..."
        echo "EXAMPLE_ACTION_OUTPUT1=${template_action_datetime}" >> $GITHUB_ENV
        echo "EXAMPLE_ACTION_OUTPUT1=${template_action_datetime}" >> "$GITHUB_OUTPUT"
        echo ""
        ##
        echo ""
        echo "finishing the 'template-example-output' step... "
        echo "::endgroup::"
      shell: bash

    - name: Output variables from this job to the action output
      # Output variables for the action
      id: set-vars-output
      run: |
        echo "::group::starting the 'set-vars-output' step... "
        echo ""
        echo "EXAMPLE_ACTION_OUTPUT1=${EXAMPLE_ACTION_OUTPUT1}" >> "$GITHUB_OUTPUT"
        ##
        if [[ "${{ inputs.verbose }}" == "true" ]]; then
            echo ""
            echo "=== Action Outputs ==="
            echo "EXAMPLE_ACTION_OUTPUT1:  ${EXAMPLE_ACTION_OUTPUT1}"
            echo ""
        fi
        ##
        echo ""
        echo "finishing the 'set-vars-output' step... "
        echo "::endgroup::"
      shell: bash

branding:
  # https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#branding
  # Ref: https://haya14busa.github.io/github-action-brandings/
  # fork: https://github.com/rwaight/github-action-brandings
  icon: 'edit'
  color: 'blue'
