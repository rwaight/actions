name: 'Get image info'
description: 'Get information about an image from a cloud provider.'
# Ref: https://docs.github.com/en/actions/creating-actions/creating-a-composite-action
author: 'rwaight'
# https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#branding
branding:
  icon: 'edit'
  color: 'blue'
  # Ref: https://haya14busa.github.io/github-action-brandings/
  # fork: https://github.com/rwaight/github-action-brandings

# https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#inputs
inputs:
  cloud-account-id:
    description: 'The cloud provider, should be one of: AWS or GCP '
    required: true
  cloud-provider:
    description: 'The cloud provider, should be one of: AWS or GCP '
    default: 'AWS'
    required: false
  cloud-region:
    description: 'The region of the cloud provider, should be a valid region based on the provider. Example `us-east-2` for `AWS` '
    default: 'us-east-2'
    required: false
  # gh-token:
  #   description: 'GITHUB_TOKEN or a `repo` scoped Personal Access Token (PAT), may be needed for the GitHub CLI. '
  #   required: false
  #   default: ${{ github.token }}
  my-example-input1:
    description: 'An example input that you can use.'
    required: true
  provider-access-key:
    description: 'The access key ID, or API key, for the cloud provider.'
    required: true
  provider-access-key-secret:
    description: 'The access key secret for the cloud provider, this is required if authenticating with an access-key.'
    required: false
  provider-access-type:
    description: 'Specify if using an `access-key` or `api-key` when connecting to the cloud provider, defaults to access-key.'
    default: 'access-key'
    required: false
  verbose:
    description: 'Determine if the action should run verbose tasks, defaults to false. '
    required: false
    default: 'false'

# https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#outputs-for-composite-actions
outputs:
  action-output1:
    description: "The example output from this action. "
    value: ${{ steps.set-vars-output.outputs.EXAMPLE_ACTION_OUTPUT1 }}

# https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions#runs-for-composite-actions
runs:
  using: "composite"
  steps:
    - name: Validate that the runner OS is Linux
      if: ${{ runner.os != 'Linux' }}
      # https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-an-error-message
      shell: bash
      run: |
        echo "::error title=â›” error hint::This action supports Linux only"
        exit 1

    - name: Greet the triggering_actor
      if: inputs.verbose=='true'
      shell: bash
      run: echo Hello ${{ github.triggering_actor }}, the verbose variable is set to true.

    - name: Verbose | Print the inputs
      if: inputs.verbose=='true'
      id: verbose-print-inputs
      shell: bash
      run: | 
        ## Print the inputs if inputs.verbose=='true'
        ## the double number signs below are for line spacing and readability only
        ##
        echo "gh-token SHOULD BE MASKED, but is set to ${{ inputs.gh-token }} "
        echo "my-example-input1 is set to ${{ inputs.my-example-input1 }} "
        echo "verbose is set to ${{ inputs.verbose }} "
        ##

    - name: This is a template only
      id: template-example-output
      shell: bash
      run: |
        ## Print a message about this being a template action only.
        ## the double number signs below are for line spacing and readability only
        ##
        echo "This action is only a template for building composite actions. "
        echo "Reference GitHub's creating a composite action guide, at "
        echo "https://docs.github.com/en/actions/creating-actions/creating-a-composite-action "
        echo " for more information. "
        echo ""
        echo "Running step 'template-example-output', which sends variables to GitHub output. "
        template_action_datetime=$(date +%Y%m%d-%Z-%H%M)
        echo "The current datetime is ${template_action_datetime}"
        echo "Setting EXAMPLE_ACTION_OUTPUT1 to '${template_action_datetime}'..."
        echo "EXAMPLE_ACTION_OUTPUT1=${template_action_datetime}" >> $GITHUB_ENV
        echo "EXAMPLE_ACTION_OUTPUT1=${template_action_datetime}" >> "$GITHUB_OUTPUT"
        echo ""

    # Output variables for the action
    - name: Output variables from this job to the action output
      id: set-vars-output
      shell: bash
      run: |
        echo "EXAMPLE_ACTION_OUTPUT1=${EXAMPLE_ACTION_OUTPUT1}" >> "$GITHUB_OUTPUT"
